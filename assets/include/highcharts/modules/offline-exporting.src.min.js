!function(a){a.CanVGRenderer={},a.Chart.prototype.exportChartLocal=function(b,c){function d(a,b){++o,b.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",a),o===f.length&&t()}var e,f,g,h,i,j=this,k=a.merge(j.options.exporting,b),l=navigator.userAgent.indexOf("WebKit")>-1&&navigator.userAgent.indexOf("Chrome")<0,m=k.scale||2,n=window.URL||window.webkitURL||window,o=0,p=function(){if(!1===k.fallbackToExportServer)throw"Fallback to export server disabled";j.exportChart(k)},q=function(a,b,c,d,e,f,g){var h=new Image;l||(h.crossOrigin="Anonymous"),h.onload=function(){var f,i=document.createElement("canvas"),j=i.getContext&&i.getContext("2d");if(j){i.height=h.height*m,i.width=h.width*m,j.drawImage(h,0,0,i.width,i.height);try{f=i.toDataURL(),c(f,b)}catch(c){if("SecurityError"!==c.name&&"SECURITY_ERR"!==c.name&&"SecurityError"!==c.message)throw c;d(a,b)}}else e(a,b);g&&g(a,b)},h.onerror=function(){f(a,b),g&&g(a,b)},h.src=a},r=function(a){try{if(!l&&navigator.userAgent.toLowerCase().indexOf("firefox")<0)return n.createObjectURL(new Blob([a],{type:"image/svg+xml;charset-utf-16"}))}catch(a){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(a)},s=function(a,b){var c,d=document.createElement("a"),e=(k.filename||"chart")+"."+b;if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(a,e);if(void 0!==d.download)d.href=a,d.download=e,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d);else try{if(void 0===(c=window.open(a,"chart"))||null===c)throw 1}catch(b){window.location.href=a}},t=function(){var b,c,d=j.sanitizeSVG(e.innerHTML);if(k&&"image/svg+xml"===k.type)try{navigator.msSaveOrOpenBlob?(c=new MSBlobBuilder,c.append(d),b=c.getBlob("image/svg+xml")):b=r(d),s(b,"svg")}catch(a){p()}else b=r(d),q(b,{},function(a){try{s(a,"png")}catch(a){p()}},function(){var b=document.createElement("canvas"),c=b.getContext("2d"),e=d.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*m,f=d.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*m,g=function(){c.drawSvg(d,0,0,e,f);try{s(navigator.msSaveOrOpenBlob?b.msToBlob():b.toDataURL("image/png"),"png")}catch(a){p()}};b.width=e,b.height=f,window.canvg?g():(j.showLoading(),HighchartsAdapter.getScript(a.getOptions().global.canvasToolsURL,function(){j.hideLoading(),g()}))},p,p,function(){try{n.revokeObjectURL(b)}catch(a){}})};a.wrap(a.Chart.prototype,"getChartHTML",function(a){return e=this.container.cloneNode(!0),a.apply(this,Array.prototype.slice.call(arguments,1))}),j.getSVGForExport(k,c),f=e.getElementsByTagName("image");try{for(f.length||t(),h=0,i=f.length;h<i;++h)g=f[h],q(g.getAttributeNS("http://www.w3.org/1999/xlink","href"),{imageElement:g},d,p,p,p)}catch(a){p()}},a.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]}(Highcharts);