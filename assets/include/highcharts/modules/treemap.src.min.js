!function(a){var b=a.seriesTypes,c=a.map,d=a.merge,e=a.extend,f=a.extendClass,g=a.getOptions(),h=g.plotOptions,i=function(){},j=a.each,k=HighchartsAdapter.grep,l=a.pick,m=a.Series,n=a.Color,o=function(a,b,c){var d;c=c||this;for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)},p=function(a,b,c,d){return d=d||this,a=a||[],j(a,function(e,f){c=b.call(d,c,e,f,a)}),c},q=function(a,b,c){var d;c=c||this,!1!==(d=b.call(c,a))&&q(d,b,c)};h.treemap=d(h.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:b.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var r={pointAttrToOptions:{},pointArrayMap:["value"],axisTypes:b.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:i,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:b.heatmap&&b.heatmap.prototype.translateColors};b.treemap=f(b.scatter,d(r,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:f(a.Point,{setVisible:b.pie.prototype.pointClass.prototype.setVisible}),getListOfParents:function(a,b){var c=p(a,function(a,b,c){var d=l(b.parent,"");return void 0===a[d]&&(a[d]=[]),a[d].push(c),a},{});return o(c,function(a,c,d){""!==c&&-1===HighchartsAdapter.inArray(c,b)&&(j(a,function(a){d[""].push(a)}),delete d[c])}),c},getTree:function(){var a,b=this,d=c(this.data,function(a){return a.id}),e=b.getListOfParents(this.data,d);return b.nodeMap=[],a=b.buildNode("",-1,0,e,null),q(this.nodeMap[this.rootNode],function(a){var c=!1,d=a.parent;return a.visible=!0,(d||""===d)&&(c=b.nodeMap[d]),c}),q(this.nodeMap[this.rootNode].children,function(a){var b=!1;return j(a,function(a){a.visible=!0,a.children.length&&(b=(b||[]).concat(a.children))}),b}),this.setTreeValues(a),a},init:function(a,b){var c=this;m.prototype.init.call(c,a,b),c.options.allowDrillToNode&&c.drillTo()},buildNode:function(a,b,c,d,e){var f,g,h=this,i=[],k=h.points[b];return j(d[a]||[],function(b){g=h.buildNode(h.points[b].id,b,c+1,d,a),i.push(g)}),f={id:a,i:b,children:i,level:c,parent:e,visible:!1},h.nodeMap[f.id]=f,k&&(k.node=f),f},setTreeValues:function(a){var b,c=this,d=c.options,f=0,g=[],h=c.points[a.i];return j(a.children,function(a){a=c.setTreeValues(a),c.insertElementSorted(g,a,function(a,b){return a.val>b.val}),a.ignore?q(a.children,function(a){var b=!1;return j(a,function(a){e(a,{ignore:!0,isLeaf:!1,visible:!1}),a.children.length&&(b=(b||[]).concat(a.children))}),b}):f+=a.val}),b=l(h&&h.value,f),e(a,{children:g,childrenTotal:f,ignore:!(l(h&&h.visible,!0)&&b>0),isLeaf:a.visible&&!f,levelDynamic:d.levelIsConstant?a.level:a.level-c.nodeMap[c.rootNode].level,name:l(h&&h.name,""),val:b}),a},calculateChildrenAreas:function(a,b){var c,e=this,f=e.options,g=this.levelMap[a.levelDynamic+1],h=l(e[g&&g.layoutAlgorithm]&&g.layoutAlgorithm,f.layoutAlgorithm),i=f.alternateStartingDirection,m=[];c=k(a.children,function(a){return!a.ignore}),g&&g.layoutStartingDirection&&(b.direction="vertical"===g.layoutStartingDirection?0:1),m=e[h](b,c),j(c,function(a,c){var f=m[c];a.values=d(f,{val:a.childrenTotal,direction:i?1-b.direction:b.direction}),a.pointValues=d(f,{x:f.x/e.axisRatio,width:f.width/e.axisRatio}),a.children.length&&e.calculateChildrenAreas(a,a.values)})},setPointValues:function(){var a=this,b=a.xAxis,c=a.yAxis;j(a.points,function(a){var d,e,f,g,h=a.node,i=h.pointValues;i?(d=Math.round(b.translate(i.x,0,0,0,1)),e=Math.round(b.translate(i.x+i.width,0,0,0,1)),f=Math.round(c.translate(i.y,0,0,0,1)),g=Math.round(c.translate(i.y+i.height,0,0,0,1)),a.shapeType="rect",a.shapeArgs={x:Math.min(d,e),y:Math.min(f,g),width:Math.abs(e-d),height:Math.abs(g-f)},a.plotX=a.shapeArgs.x+a.shapeArgs.width/2,a.plotY=a.shapeArgs.y+a.shapeArgs.height/2):(delete a.plotX,delete a.plotY)})},setColorRecursive:function(a,b){var c,d,e=this;a&&(c=e.points[a.i],d=e.levelMap[a.levelDynamic],b=l(c&&c.options.color,d&&d.color,b),c&&(c.color=b),a.children.length&&j(a.children,function(a){e.setColorRecursive(a,b)}))},alg_func_group:function(a,b,c,d){this.height=a,this.width=b,this.plot=d,this.direction=c,this.startDirection=c,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(a,b){return Math.max(a/b,b/a)}},this.addElement=function(a){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+a,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(a)},this.reset=function(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(a,b,c,d){var e,f,g,h,i,k=c.lW,l=c.lH,m=c.plot,n=0,o=c.elArr.length-1;b?(k=c.nW,l=c.nH):i=c.elArr[c.elArr.length-1],j(c.elArr,function(a){(b||n<o)&&(0===c.direction?(e=m.x,f=m.y,g=k,h=a/g):(e=m.x,f=m.y,h=l,g=a/h),d.push({x:e,y:f,width:g,height:h}),0===c.direction?m.y=m.y+h:m.x=m.x+g),n+=1}),c.reset(),0===c.direction?c.width=c.width-k:c.height=c.height-l,m.y=m.parent.y+(m.parent.height-c.height),m.x=m.parent.x+(m.parent.width-c.width),a&&(c.direction=1-c.direction),b||c.addElement(i)},alg_func_lowAspectRatio:function(a,b,c){var d,e=[],f=this,g={x:b.x,y:b.y,parent:b},h=b.direction,i=0,k=c.length-1,l=new this.alg_func_group(b.height,b.width,h,g);return j(c,function(c){d=b.width*b.height*(c.val/b.val),l.addElement(d),l.lP.nR>l.lP.lR&&f.alg_func_calcPoints(a,!1,l,e,g),i===k&&f.alg_func_calcPoints(a,!0,l,e,g),i+=1}),e},alg_func_fill:function(a,b,c){var d,e,f,g,h,i=[],k=b.direction,l=b.x,m=b.y,n=b.width,o=b.height;return j(c,function(c){d=b.width*b.height*(c.val/b.val),e=l,f=m,0===k?(h=o,g=d/h,n-=g,l+=g):(g=n,h=d/g,o-=h,m+=h),i.push({x:e,y:f,width:g,height:h}),a&&(k=1-k)}),i},strip:function(a,b){return this.alg_func_lowAspectRatio(!1,a,b)},squarified:function(a,b){return this.alg_func_lowAspectRatio(!0,a,b)},sliceAndDice:function(a,b){return this.alg_func_fill(!0,a,b)},stripes:function(a,b){return this.alg_func_fill(!1,a,b)},translate:function(){var a,b,c,e;m.prototype.translate.call(this),this.points.length&&(this.rootNode=l(this.options.rootId,""),this.levelMap=p(this.options.levels,function(a,b){return a[b.level]=b,a},{}),c=this.tree=this.getTree(),this.axisRatio=this.xAxis.len/this.yAxis.len,this.nodeMap[""].pointValues=a={x:0,y:0,width:100,height:100},this.nodeMap[""].values=b=d(a,{width:a.width*this.axisRatio,direction:"vertical"===this.options.layoutStartingDirection?0:1,val:c.val}),this.calculateChildrenAreas(c,b)),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0),e=this.nodeMap[this.rootNode].pointValues,this.xAxis.setExtremes(e.x,e.x+e.width,!1),this.yAxis.setExtremes(e.y,e.y+e.height,!1),this.xAxis.setScale(),this.yAxis.setScale(),this.setPointValues()},drawDataLabels:function(){var a,b,c=this,e=k(c.points,function(a){return a.node.visible});j(e,function(e){b=c.levelMap[e.node.levelDynamic],a={style:{}},e.node.isLeaf||(a.enabled=!1),b&&b.dataLabels&&(a=d(a,b.dataLabels),c._hasPointLabels=!0),e.shapeArgs&&(a.style.width=e.shapeArgs.width),e.dlOptions=d(a,e.options.dataLabels)}),m.prototype.drawDataLabels.call(this)},alignDataLabel:b.column.prototype.alignDataLabel,pointAttribs:function(a,b){var c,d=this.levelMap[a.node.levelDynamic]||{},e=this.options,f=b&&e.states[b]||{};return c={stroke:a.borderColor||d.borderColor||f.borderColor||e.borderColor,"stroke-width":l(a.borderWidth,d.borderWidth,f.borderWidth,e.borderWidth),dashstyle:a.borderDashStyle||d.borderDashStyle||f.borderDashStyle||e.borderDashStyle,fill:a.color||this.color},"hover"===b&&(c.zIndex=1),a.node.level<=this.nodeMap[this.rootNode].level?(c.fill="none",c["stroke-width"]=0):a.node.isLeaf?b&&(c.fill=n(c.fill).brighten(f.brightness).get()):c.fill=l(e.interactByLeaf,!e.allowDrillToNode)?"none":n(c.fill).setOpacity("hover"===b?.75:.15).get(),c},drawPoints:function(){var a=this,c=k(a.points,function(a){return a.node.visible});j(c,function(b){var c="levelGroup-"+b.node.levelDynamic;a[c]||(a[c]=a.chart.renderer.g(c).attr({zIndex:1e3-b.node.levelDynamic}).add(a.group)),b.group=a[c],b.pointAttr={"":a.pointAttribs(b),hover:a.pointAttribs(b,"hover"),select:{}}}),b.column.prototype.drawPoints.call(this),a.options.allowDrillToNode&&j(c,function(b){var c,d;b.graphic&&(d=b.drillId=a.options.interactByLeaf?a.drillToByLeaf(b):a.drillToByGroup(b),c=d?"pointer":"default",b.graphic.css({cursor:c}))})},insertElementSorted:function(a,b,c){var d=0,e=!1;0!==a.length&&j(a,function(f){c(b,f)&&!e&&(a.splice(d,0,b),e=!0),d+=1}),e||a.push(b)},drillTo:function(){var b=this;a.addEvent(b,"click",function(a){var c,d=a.point,e=d.drillId;e&&(c=b.nodeMap[b.rootNode].name||b.rootNode,d.setState(""),b.drillToNode(e),b.showDrillUpButton(c))})},drillToByGroup:function(a){var b=this,c=!1;return a.node.level-b.nodeMap[b.rootNode].level!=1||a.node.isLeaf||(c=a.id),c},drillToByLeaf:function(a){var b,c=this,d=!1;if(a.node.parent!==c.rootNode&&a.node.isLeaf)for(b=a.node;!d;)b=c.nodeMap[b.parent],b.parent===c.rootNode&&(d=b.id);return d},drillUp:function(){var a,b,c=null;this.rootNode&&(a=this.nodeMap[this.rootNode],c=null!==a.parent?this.nodeMap[a.parent]:this.nodeMap[""]),null!==c&&(this.drillToNode(c.id),""===c.id?this.drillUpButton=this.drillUpButton.destroy():(b=this.nodeMap[c.parent],this.showDrillUpButton(b.name||b.id)))},drillToNode:function(a){this.options.rootId=a,this.isDirty=!0,this.chart.redraw()},showDrillUpButton:function(a){var b,c,d=this,e=a||"< Back",f=d.options.drillUpButton;f.text&&(e=f.text),this.drillUpButton?this.drillUpButton.attr({text:e}).align():(b=f.theme,c=b&&b.states,this.drillUpButton=this.chart.renderer.button(e,null,null,function(){d.drillUp()},b,c&&c.hover,c&&c.select).attr({align:f.position.align,zIndex:9}).add().align(f.position,!1,f.relativeTo||"plotBox"))},buildKDTree:i,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getExtremes:function(){m.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,m.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var b={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};m.prototype.bindAxes.call(this),a.extend(this.yAxis.options,b),a.extend(this.xAxis.options,b)}}))}(Highcharts);