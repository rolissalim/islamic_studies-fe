!function(a){a.CanVGRenderer={},a.Chart.prototype.exportChartLocal=function(b,c){var d,e,f,g,h,i=this,j=a.merge(i.options.exporting,b),k=navigator.userAgent.indexOf("WebKit")>-1&&navigator.userAgent.indexOf("Chrome")<0,l=j.scale||2,m=window.URL||window.webkitURL||window,n=0,o=function(){if(!1===j.fallbackToExportServer)throw"Fallback to export server disabled";i.exportChart(j)},p=function(a,b,c,d,e,f,g){var h=new Image;k||(h.crossOrigin="Anonymous"),h.onload=function(){var f,i=document.createElement("canvas"),j=i.getContext&&i.getContext("2d");if(j){i.height=h.height*l,i.width=h.width*l,j.drawImage(h,0,0,i.width,i.height);try{f=i.toDataURL(),c(f,b)}catch(c){if("SecurityError"!==c.name&&"SECURITY_ERR"!==c.name&&"SecurityError"!==c.message)throw c;d(a,b)}}else e(a,b);g&&g(a,b)},h.onerror=function(){f(a,b),g&&g(a,b)},h.src=a},q=function(a){try{if(!k&&navigator.userAgent.toLowerCase().indexOf("firefox")<0)return m.createObjectURL(new Blob([a],{type:"image/svg+xml;charset-utf-16"}))}catch(a){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(a)},r=function(a,b){var c,d=document.createElement("a"),e=(j.filename||"chart")+"."+b;if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(a,e);else if(void 0!==d.download)d.href=a,d.download=e,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d);else try{if(void 0===(c=window.open(a,"chart"))||null===c)throw 1}catch(b){window.location.href=a}},s=function(){var b,c,e=i.sanitizeSVG(d.innerHTML);if(j&&"image/svg+xml"===j.type)try{navigator.msSaveOrOpenBlob?(c=new MSBlobBuilder,c.append(e),b=c.getBlob("image/svg+xml")):b=q(e),r(b,"svg")}catch(a){o()}else b=q(e),p(b,{},function(a){try{r(a,"png")}catch(a){o()}},function(){var b=document.createElement("canvas"),c=b.getContext("2d"),d=e.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*l,f=e.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*l,g=function(){c.drawSvg(e,0,0,d,f);try{r(navigator.msSaveOrOpenBlob?b.msToBlob():b.toDataURL("image/png"),"png")}catch(a){o()}};b.width=d,b.height=f,window.canvg?g():(i.showLoading(),HighchartsAdapter.getScript(a.getOptions().global.canvasToolsURL,function(){i.hideLoading(),g()}))},o,o,function(){try{m.revokeObjectURL(b)}catch(a){}})};a.wrap(a.Chart.prototype,"getChartHTML",function(a){return d=this.container.cloneNode(!0),a.apply(this,Array.prototype.slice.call(arguments,1))}),i.getSVGForExport(j,c),e=d.getElementsByTagName("image");try{e.length||s();var t=function(a,b){++n,b.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",a),n===e.length&&s()};for(g=0,h=e.length;g<h;++g)f=e[g],p(f.getAttributeNS("http://www.w3.org/1999/xlink","href"),{imageElement:f},t,o,o,o)}catch(a){o()}},a.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]}(Highcharts);