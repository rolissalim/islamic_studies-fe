!function(a){var b=a.seriesTypes,c=a.map,d=a.merge,e=a.extend,f=a.extendClass,g=a.getOptions().plotOptions,h=function(){},i=a.each,j=HighchartsAdapter.grep,k=a.pick,l=a.Series,m=a.Color,n=function(a,b,c){var d,c=c||this;for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)},o=function(a,b,c,d){return d=d||this,a=a||[],i(a,function(e,f){c=b.call(d,c,e,f,a)}),c},p=function(a,b,c){c=c||this,!1!==(a=b.call(c,a))&&p(a,b,c)};g.treemap=d(g.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:b.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}}),b.treemap=f(b.scatter,d({pointAttrToOptions:{},pointArrayMap:["value"],axisTypes:b.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:h,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:b.heatmap&&b.heatmap.prototype.translateColors},{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:f(a.Point,{setVisible:b.pie.prototype.pointClass.prototype.setVisible}),getListOfParents:function(a,b){var c=o(a,function(a,b,c){return b=k(b.parent,""),void 0===a[b]&&(a[b]=[]),a[b].push(c),a},{});return n(c,function(a,c,d){""!==c&&-1===HighchartsAdapter.inArray(c,b)&&(i(a,function(a){d[""].push(a)}),delete d[c])}),c},getTree:function(){var a,b=this;return a=c(this.data,function(a){return a.id}),a=b.getListOfParents(this.data,a),b.nodeMap=[],a=b.buildNode("",-1,0,a,null),p(this.nodeMap[this.rootNode],function(a){var c=!1,d=a.parent;return a.visible=!0,(d||""===d)&&(c=b.nodeMap[d]),c}),p(this.nodeMap[this.rootNode].children,function(a){var b=!1;return i(a,function(a){a.visible=!0,a.children.length&&(b=(b||[]).concat(a.children))}),b}),this.setTreeValues(a),a},init:function(a,b){l.prototype.init.call(this,a,b),this.options.allowDrillToNode&&this.drillTo()},buildNode:function(a,b,c,d,e){var f,g=this,h=[],j=g.points[b];return i(d[a]||[],function(b){f=g.buildNode(g.points[b].id,b,c+1,d,a),h.push(f)}),b={id:a,i:b,children:h,level:c,parent:e,visible:!1},g.nodeMap[b.id]=b,j&&(j.node=b),b},setTreeValues:function(a){var b,c=this,d=c.options,f=0,g=[],h=c.points[a.i];return i(a.children,function(a){a=c.setTreeValues(a),c.insertElementSorted(g,a,function(a,b){return a.val>b.val}),a.ignore?p(a.children,function(a){var b=!1;return i(a,function(a){e(a,{ignore:!0,isLeaf:!1,visible:!1}),a.children.length&&(b=(b||[]).concat(a.children))}),b}):f+=a.val}),b=k(h&&h.value,f),e(a,{children:g,childrenTotal:f,ignore:!(k(h&&h.visible,!0)&&b>0),isLeaf:a.visible&&!f,levelDynamic:d.levelIsConstant?a.level:a.level-c.nodeMap[c.rootNode].level,name:k(h&&h.name,""),val:b}),a},calculateChildrenAreas:function(a,b){var c=this,e=c.options,f=this.levelMap[a.levelDynamic+1],g=k(c[f&&f.layoutAlgorithm]&&f.layoutAlgorithm,e.layoutAlgorithm),h=e.alternateStartingDirection,l=[],e=j(a.children,function(a){return!a.ignore});f&&f.layoutStartingDirection&&(b.direction="vertical"===f.layoutStartingDirection?0:1),l=c[g](b,e),i(e,function(a,e){var f=l[e];a.values=d(f,{val:a.childrenTotal,direction:h?1-b.direction:b.direction}),a.pointValues=d(f,{x:f.x/c.axisRatio,width:f.width/c.axisRatio}),a.children.length&&c.calculateChildrenAreas(a,a.values)})},setPointValues:function(){var a=this.xAxis,b=this.yAxis;i(this.points,function(c){var d,e,f,g=c.node.pointValues;g?(d=Math.round(a.translate(g.x,0,0,0,1)),e=Math.round(a.translate(g.x+g.width,0,0,0,1)),f=Math.round(b.translate(g.y,0,0,0,1)),g=Math.round(b.translate(g.y+g.height,0,0,0,1)),c.shapeType="rect",c.shapeArgs={x:Math.min(d,e),y:Math.min(f,g),width:Math.abs(e-d),height:Math.abs(g-f)},c.plotX=c.shapeArgs.x+c.shapeArgs.width/2,c.plotY=c.shapeArgs.y+c.shapeArgs.height/2):(delete c.plotX,delete c.plotY)})},setColorRecursive:function(a,b){var c,d,e=this;a&&(c=e.points[a.i],d=e.levelMap[a.levelDynamic],b=k(c&&c.options.color,d&&d.color,b),c&&(c.color=b),a.children.length&&i(a.children,function(a){e.setColorRecursive(a,b)}))},alg_func_group:function(a,b,c,d){this.height=a,this.width=b,this.plot=d,this.startDirection=this.direction=c,this.lH=this.nH=this.lW=this.nW=this.total=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(a,b){return Math.max(a/b,b/a)}},this.addElement=function(a){this.lP.total=this.elArr[this.elArr.length-1],this.total+=a,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(a)},this.reset=function(){this.lW=this.nW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(a,b,c,d){var e,f,g,h,j,k=c.lW,l=c.lH,m=c.plot,n=0,o=c.elArr.length-1;b?(k=c.nW,l=c.nH):j=c.elArr[c.elArr.length-1],i(c.elArr,function(a){(b||n<o)&&(0===c.direction?(e=m.x,f=m.y,g=k,h=a/g):(e=m.x,f=m.y,h=l,g=a/h),d.push({x:e,y:f,width:g,height:h}),0===c.direction?m.y+=h:m.x+=g),n+=1}),c.reset(),0===c.direction?c.width-=k:c.height-=l,m.y=m.parent.y+(m.parent.height-c.height),m.x=m.parent.x+(m.parent.width-c.width),a&&(c.direction=1-c.direction),b||c.addElement(j)},alg_func_lowAspectRatio:function(a,b,c){var d,e=[],f=this,g={x:b.x,y:b.y,parent:b},h=0,j=c.length-1,k=new this.alg_func_group(b.height,b.width,b.direction,g);return i(c,function(c){d=b.width*b.height*(c.val/b.val),k.addElement(d),k.lP.nR>k.lP.lR&&f.alg_func_calcPoints(a,!1,k,e,g),h===j&&f.alg_func_calcPoints(a,!0,k,e,g),h+=1}),e},alg_func_fill:function(a,b,c){var d,e,f,g,h,j=[],k=b.direction,l=b.x,m=b.y,n=b.width,o=b.height;return i(c,function(c){d=b.width*b.height*(c.val/b.val),e=l,f=m,0===k?(h=o,g=d/h,n-=g,l+=g):(g=n,h=d/g,o-=h,m+=h),j.push({x:e,y:f,width:g,height:h}),a&&(k=1-k)}),j},strip:function(a,b){return this.alg_func_lowAspectRatio(!1,a,b)},squarified:function(a,b){return this.alg_func_lowAspectRatio(!0,a,b)},sliceAndDice:function(a,b){return this.alg_func_fill(!0,a,b)},stripes:function(a,b){return this.alg_func_fill(!1,a,b)},translate:function(){var a,b;l.prototype.translate.call(this),this.points.length&&(this.rootNode=k(this.options.rootId,""),this.levelMap=o(this.options.levels,function(a,b){return a[b.level]=b,a},{}),b=this.tree=this.getTree(),this.axisRatio=this.xAxis.len/this.yAxis.len,this.nodeMap[""].pointValues=a={x:0,y:0,width:100,height:100},this.nodeMap[""].values=a=d(a,{width:a.width*this.axisRatio,direction:"vertical"===this.options.layoutStartingDirection?0:1,val:b.val}),this.calculateChildrenAreas(b,a)),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0),b=this.nodeMap[this.rootNode].pointValues,this.xAxis.setExtremes(b.x,b.x+b.width,!1),this.yAxis.setExtremes(b.y,b.y+b.height,!1),this.xAxis.setScale(),this.yAxis.setScale(),this.setPointValues()},drawDataLabels:function(){var a,b,c=this,e=j(c.points,function(a){return a.node.visible});i(e,function(e){b=c.levelMap[e.node.levelDynamic],a={style:{}},e.node.isLeaf||(a.enabled=!1),b&&b.dataLabels&&(a=d(a,b.dataLabels),c._hasPointLabels=!0),e.shapeArgs&&(a.style.width=e.shapeArgs.width),e.dlOptions=d(a,e.options.dataLabels)}),l.prototype.drawDataLabels.call(this)},alignDataLabel:b.column.prototype.alignDataLabel,pointAttribs:function(a,b){var c=this.levelMap[a.node.levelDynamic]||{},d=this.options,e=b&&d.states[b]||{},c={stroke:a.borderColor||c.borderColor||e.borderColor||d.borderColor,"stroke-width":k(a.borderWidth,c.borderWidth,e.borderWidth,d.borderWidth),dashstyle:a.borderDashStyle||c.borderDashStyle||e.borderDashStyle||d.borderDashStyle,fill:a.color||this.color};return"hover"===b&&(c.zIndex=1),a.node.level<=this.nodeMap[this.rootNode].level?(c.fill="none",c["stroke-width"]=0):a.node.isLeaf?b&&(c.fill=m(c.fill).brighten(e.brightness).get()):c.fill=k(d.interactByLeaf,!d.allowDrillToNode)?"none":m(c.fill).setOpacity("hover"===b?.75:.15).get(),c},drawPoints:function(){var a=this,c=j(a.points,function(a){return a.node.visible});i(c,function(b){var c="levelGroup-"+b.node.levelDynamic;a[c]||(a[c]=a.chart.renderer.g(c).attr({zIndex:1e3-b.node.levelDynamic}).add(a.group)),b.group=a[c],b.pointAttr={"":a.pointAttribs(b),hover:a.pointAttribs(b,"hover"),select:{}}}),b.column.prototype.drawPoints.call(this),a.options.allowDrillToNode&&i(c,function(b){var c;b.graphic&&(c=b.drillId=a.options.interactByLeaf?a.drillToByLeaf(b):a.drillToByGroup(b),b.graphic.css({cursor:c?"pointer":"default"}))})},insertElementSorted:function(a,b,c){var d=0,e=!1;0!==a.length&&i(a,function(f){c(b,f)&&!e&&(a.splice(d,0,b),e=!0),d+=1}),e||a.push(b)},drillTo:function(){var b=this;a.addEvent(b,"click",function(a){var c,a=a.point,d=a.drillId;d&&(c=b.nodeMap[b.rootNode].name||b.rootNode,a.setState(""),b.drillToNode(d),b.showDrillUpButton(c))})},drillToByGroup:function(a){var b=!1;return a.node.level-this.nodeMap[this.rootNode].level!=1||a.node.isLeaf||(b=a.id),b},drillToByLeaf:function(a){var b=!1;if(a.node.parent!==this.rootNode&&a.node.isLeaf)for(a=a.node;!b;)a=this.nodeMap[a.parent],a.parent===this.rootNode&&(b=a.id);return b},drillUp:function(){var a=null;this.rootNode&&(a=this.nodeMap[this.rootNode],a=null!==a.parent?this.nodeMap[a.parent]:this.nodeMap[""]),null!==a&&(this.drillToNode(a.id),""===a.id?this.drillUpButton=this.drillUpButton.destroy():(a=this.nodeMap[a.parent],this.showDrillUpButton(a.name||a.id)))},drillToNode:function(a){this.options.rootId=a,this.isDirty=!0,this.chart.redraw()},showDrillUpButton:function(a){var b,c,d=this,a=a||"< Back",e=d.options.drillUpButton;e.text&&(a=e.text),this.drillUpButton?this.drillUpButton.attr({text:a}).align():(c=(b=e.theme)&&b.states,this.drillUpButton=this.chart.renderer.button(a,null,null,function(){d.drillUp()},b,c&&c.hover,c&&c.select).attr({align:e.position.align,zIndex:9}).add().align(e.position,!1,e.relativeTo||"plotBox"))},buildKDTree:h,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getExtremes:function(){l.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,l.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var b={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};l.prototype.bindAxes.call(this),a.extend(this.yAxis.options,b),a.extend(this.xAxis.options,b)}}))}(Highcharts);