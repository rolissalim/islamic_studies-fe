!function(){function a(a){function b(a){return a.text}function c(){return"serif"}function d(){return"normal"}function e(a){return Math.sqrt(a.value)}function f(){return 30*(~~(6*Math.random())-3)}function g(){return 1}function h(a,b,c){if(!a.sprite){t.clearRect(0,0,(q<<5)/s,r/s);var d=0,e=0,f=0,g=b.length;for(--c;++c<g;){a=b[c],t.save(),t.font=a.style+" "+a.weight+" "+~~((a.size+1)/s)+"px "+a.font;var h=t.measureText(a.text+"m").width*s,i=a.size<<1;if(a.rotate){var j=Math.sin(a.rotate*p),k=Math.cos(a.rotate*p),l=h*k,m=h*j,n=i*k,o=i*j;h=Math.max(Math.abs(l+o),Math.abs(l-o))+31>>5<<5,i=~~Math.max(Math.abs(m+n),Math.abs(m-n))}else h=h+31>>5<<5;if(i>f&&(f=i),d+h>=q<<5&&(d=0,e+=f,f=0),e+i>=r)break;t.translate((d+(h>>1))/s,(e+(i>>1))/s),a.rotate&&t.rotate(a.rotate*p),t.fillText(a.text,0,0),a.padding&&(t.lineWidth=2*a.padding,t.strokeText(a.text,0,0)),t.restore(),a.width=h,a.height=i,a.xoff=d,a.yoff=e,a.x1=h>>1,a.y1=i>>1,a.x0=-a.x1,a.y0=-a.y1,a.hasText=!0,d+=h}for(var u=t.getImageData(0,0,(q<<5)/s,r/s).data,v=[];--c>=0;)if(a=b[c],a.hasText){for(var h=a.width,w=h>>5,i=a.y1-a.y0,x=0;x<i*w;x++)v[x]=0;if(null==(d=a.xoff))return;e=a.yoff;for(var y=0,z=-1,A=0;A<i;A++){for(var x=0;x<h;x++){var B=w*A+(x>>5),C=u[(e+A)*(q<<5)+(d+x)<<2]?1<<31-x%32:0;v[B]|=C,y|=C}y?z=A:(a.y0++,i--,A--,e++)}a.y1=a.y0+z,a.sprite=v.slice(0,(a.y1-a.y0)*w)}}}function i(a,b,c){c>>=5;for(var d,e=a.sprite,f=a.width>>5,g=a.x-(f<<4),h=127&g,i=32-h,j=a.y1-a.y0,k=(a.y+a.y0)*c+(g>>5),l=0;l<j;l++){d=0;for(var m=0;m<=f;m++)if((d<<i|(m<f?(d=e[l*f+m])>>>h:0))&b[k+m])return!0;k+=c}return!1}function j(a,b){var c=a[0],d=a[1];b.x+b.x0<c.x&&(c.x=b.x+b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>d.x&&(d.x=b.x+b.x1),b.y+b.y1>d.y&&(d.y=b.y+b.y1)}function k(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function l(a){var b=a[0]/a[1];return function(a){return[b*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function m(a){var b=4*a[0]/a[1],c=0,d=0;return function(a){var e=a<0?-1:1;switch(Math.sqrt(1+4*e*a)-e&3){case 0:c+=b;break;case 1:d+=4;break;case 2:c-=b;break;default:d-=4}return[c,d]}}function n(a){for(var b=[],c=-1;++c<a;)b[c]=0;return b}a.layout.cloud=function(){function m(a,b,c){for(var d,e,f,g=(o[0],o[1],b.x),h=b.y,j=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=x(o),m=C()<.5?1:-1,n=-m;(d=l(n+=m))&&(e=~~d[0],f=~~d[1],!(Math.min(Math.abs(e),Math.abs(f))>=j));)if(b.x=g+e,b.y=h+f,!(b.x+b.x0<0||b.y+b.y0<0||b.x+b.x1>o[0]||b.y+b.y1>o[1])&&(!c||!i(b,a,o[0]))&&(!c||k(b,c))){for(var p,q=b.sprite,r=b.width>>5,s=o[0]>>5,t=b.x-(r<<4),u=127&t,v=32-u,w=b.y1-b.y0,y=(b.y+b.y0)*s+(t>>5),z=0;z<w;z++){p=0;for(var A=0;A<=r;A++)a[y+A]|=p<<v|(A<r?(p=q[z*r+A])>>>u:0);y+=s}return delete b.sprite,!0}return!1}var o=[256,256],p=b,q=c,r=e,s=d,t=d,v=f,w=g,x=l,y=[],z=1/0,A=a.dispatch("word","end"),B=null,C=Math.random,D={};return D.start=function(){function a(){for(var a=Date.now();Date.now()-a<z&&++e<d&&B;){var i=g[e];i.x=o[0]*(C()+.5)>>1,i.y=o[1]*(C()+.5)>>1,h(i,g,e),i.hasText&&m(b,i,c)&&(f.push(i),A.word(i),c?j(c,i):c=[{x:i.x+i.x0,y:i.y+i.y0},{x:i.x+i.x1,y:i.y+i.y1}],i.x-=o[0]>>1,i.y-=o[1]>>1)}e>=d&&(D.stop(),A.end(f,c))}var b=n((o[0]>>5)*o[1]),c=null,d=y.length,e=-1,f=[],g=y.map(function(a,b){return a.text=p.call(this,a,b),a.font=q.call(this,a,b),a.style=s.call(this,a,b),a.weight=t.call(this,a,b),a.rotate=v.call(this,a,b),a.size=~~r.call(this,a,b),a.padding=w.call(this,a,b),a}).sort(function(a,b){return b.size-a.size});return B&&clearInterval(B),B=setInterval(a,0),a(),D},D.stop=function(){return B&&(clearInterval(B),B=null),D},D.timeInterval=function(a){return arguments.length?(z=null==a?1/0:a,D):z},D.words=function(a){return arguments.length?(y=a,D):y},D.size=function(a){return arguments.length?(o=[+a[0],+a[1]],D):o},D.font=function(b){return arguments.length?(q=a.functor(b),D):q},D.fontStyle=function(b){return arguments.length?(s=a.functor(b),D):s},D.fontWeight=function(b){return arguments.length?(t=a.functor(b),D):t},D.rotate=function(b){return arguments.length?(v=a.functor(b),D):v},D.text=function(b){return arguments.length?(p=a.functor(b),D):p},D.spiral=function(a){return arguments.length?(x=u[a]||a,D):x},D.fontSize=function(b){return arguments.length?(r=a.functor(b),D):r},D.padding=function(b){return arguments.length?(w=a.functor(b),D):w},D.random=function(a){return arguments.length?(C=a,D):C},a.rebind(D,A,"on")};var o,p=Math.PI/180,q=64,r=2048,s=1;"undefined"!=typeof document?(o=document.createElement("canvas"),o.width=1,o.height=1,s=Math.sqrt(o.getContext("2d").getImageData(0,0,1,1).data.length>>2),o.width=(q<<5)/s,o.height=r/s):o=new Canvas(q<<5,r);var t=o.getContext("2d"),u={archimedean:l,rectangular:m};t.fillStyle=t.strokeStyle="red",t.textAlign="center"}"function"==typeof define&&define.amd?define(["d3"],a):a(this.d3)}();